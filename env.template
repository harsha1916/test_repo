# =======================================
# ACCESS CONTROL SYSTEM - CONFIGURATION
# =======================================
# Raspberry Pi Zero 2W RFID Access Control
# Version: 2.1
# Last Updated: October 2025

# =======================================
# INSTALLATION INSTRUCTIONS
# =======================================
# 1. Copy this file: cp env.template .env
# 2. Edit .env with your settings: nano .env
# 3. Change all passwords and keys!
# 4. Save and restart service

# =======================================
# BASE DIRECTORY
# =======================================
# Main directory for all data storage
BASE_DIR=/home/pi/accessctl

# =======================================
# FIREBASE CONFIGURATION (Optional)
# =======================================
# Leave blank to disable Firebase cloud sync
# System works 100% offline if Firebase not configured
FIREBASE_CRED_FILE=service.json
ENTITY_ID=default_entity

# =======================================
# LOGGING
# =======================================
LOG_FILE=/home/pi/accessctl/access.log
LOG_LEVEL=INFO

# =======================================
# AUTHENTICATION & SECURITY
# =======================================
# Admin username for web interface
ADMIN_USERNAME=admin

# Admin password hash (SHA256)
# Default hash is for password: "admin123"
# ⚠️ CHANGE THIS IN PRODUCTION!
# Generate new hash:
#   python3 -c "import hashlib; print(hashlib.sha256('YourNewPassword'.encode()).hexdigest())"
ADMIN_PASSWORD_HASH=240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9

# API Key for REST API authentication
# ⚠️ CHANGE THIS IN PRODUCTION!
# Generate secure key:
#   python3 -c "import secrets; print(secrets.token_hex(32))"
API_KEY=your-api-key-change-this

# Session timeout (hours)
SESSION_TTL_HOURS=24

# Session secret for Flask (auto-generated if not set)
# Generate secure secret:
#   python3 -c "import secrets; print(secrets.token_hex(32))"
SESSION_SECRET=

# =======================================
# RFID READER CONFIGURATION
# =======================================
# Tag re-detect delay (seconds)
# Prevents same card from being scanned multiple times within this period
# Range: 1-300 seconds
# Recommended: 60 for offices, 30 for high-traffic, 120 for parking
SCAN_DELAY_SECONDS=60

# Wiegand bit format per reader (26 or 34)
# 26-bit: Standard proximity cards (most common - HID ProxCard II, etc.)
# 34-bit: Extended format for larger installations
# Note: Can be changed via web interface (Configuration tab)
WIEGAND_BITS_READER_1=26
WIEGAND_BITS_READER_2=26
WIEGAND_BITS_READER_3=26

# Wiegand timeout (milliseconds)
# Maximum time between individual bits before read is reset
# Default: 25ms (works for most readers)
# Range: 10-100ms
# ⚠️ Only change if you know what you're doing!
WIEGAND_TIMEOUT_MS=25

# =======================================
# GPIO PIN CONFIGURATION
# =======================================
# Using BCM (Broadcom) pin numbering, NOT physical pin numbers
# Verify with: gpio readall

# Relay output pins
RELAY_1=25
RELAY_2=26
RELAY_3=27

# RFID Reader 1 pins (Main Entrance)
D0_PIN_1=18
D1_PIN_1=23

# RFID Reader 2 pins (Secondary Door)
D0_PIN_2=19
D1_PIN_2=24

# RFID Reader 3 pins (Auxiliary/Emergency Exit)
D0_PIN_3=20
D1_PIN_3=21

# =======================================
# STORAGE MANAGEMENT
# =======================================
# Maximum transaction storage limit (GB)
# Auto-purge will delete oldest files when this limit is exceeded
# Recommended: 16GB for SD cards, adjust based on your storage
MAX_TX_STORAGE_GB=16

# Cleanup fraction (0.0 - 1.0)
# How much storage to free when limit is exceeded
# 0.5 = free 50% of capacity when cap exceeded
CLEANUP_FRACTION=0.5

# Storage check interval (seconds)
# How often the background worker checks storage usage
# Default: 300 seconds (5 minutes)
TX_STORAGE_CHECK_INTERVAL=300

# =======================================
# FLASK WEB SERVER
# =======================================
# Host address
# 0.0.0.0 = accessible from any device on network
# 127.0.0.1 = localhost only
FLASK_HOST=0.0.0.0

# Port number for web interface
# Default: 5001
# Access at: http://YOUR_PI_IP:5001
FLASK_PORT=5001

# Debug mode (true/false)
# Enables detailed error messages and auto-reload
# ⚠️ MUST be false in production for security!
FLASK_DEBUG=false

# =======================================
# ADVANCED FEATURES
# =======================================
# These features can be configured via web interface
# Values here are defaults if config.json doesn't exist

# Entry/Exit Tracking Configuration
# Note: Can be enabled/disabled via Configuration tab
# ENTRY_EXIT_ENABLED=false
# ENTRY_EXIT_MIN_GAP_SECONDS=300

# =======================================
# SECURITY NOTES
# =======================================
#
# ⚠️ BEFORE PRODUCTION DEPLOYMENT:
#
# 1. CHANGE ADMIN PASSWORD:
#    python3 -c "import hashlib; password='YourStrongPassword123'; print(hashlib.sha256(password.encode()).hexdigest())"
#    Copy the output to ADMIN_PASSWORD_HASH above
#
# 2. GENERATE SECURE API KEY:
#    python3 -c "import secrets; print(secrets.token_hex(32))"
#    Copy the output to API_KEY above
#    IMPORTANT: Also update in browser after login!
#      → Visit: http://YOUR_PI_IP:5001/setup
#      → Or run in console: setApiKey('your-new-api-key')
#
# 3. GENERATE SESSION SECRET:
#    python3 -c "import secrets; print(secrets.token_hex(32))"
#    Copy the output to SESSION_SECRET above
#
# 4. SET DEBUG TO FALSE:
#    FLASK_DEBUG=false
#
# 5. USE HTTPS (Recommended):
#    Set up nginx reverse proxy with SSL certificate
#    Use Let's Encrypt for free SSL
#
# 6. FIREWALL (Recommended):
#    sudo ufw allow 5001/tcp
#    sudo ufw enable
#
# 7. REGULAR BACKUPS:
#    Backup users.json, blocked_users.json, config.json daily
#
# =======================================
# GPIO PIN REFERENCE
# =======================================
#
# Raspberry Pi Zero 2W Pin Layout (BCM numbering):
#
# RELAY CONNECTIONS:
#   GPIO 25 (Pin 22) → Relay 1 (Main Entrance)
#   GPIO 26 (Pin 37) → Relay 2 (Secondary Door)
#   GPIO 27 (Pin 13) → Relay 3 (Auxiliary)
#
# RFID READER 1 (Main Entrance):
#   GPIO 18 (Pin 12) → D0
#   GPIO 23 (Pin 16) → D1
#
# RFID READER 2 (Secondary Door):
#   GPIO 19 (Pin 35) → D0
#   GPIO 24 (Pin 18) → D1
#
# RFID READER 3 (Auxiliary):
#   GPIO 20 (Pin 38) → D0
#   GPIO 21 (Pin 40) → D1
#
# POWER:
#   5V (Pin 2 or 4) → VCC for readers and relays
#   GND (Pins 6,9,14,20,25,30,34,39) → GND
#
# =======================================
# WIEGAND FORMAT GUIDE
# =======================================
#
# 26-BIT FORMAT (Standard):
#   - Most common proximity cards
#   - HID ProxCard II, Indala, etc.
#   - 8-bit facility code + 16-bit card number
#   - Use: WIEGAND_BITS_READER_X=26
#
# 34-BIT FORMAT (Extended):
#   - Larger installations
#   - 16-bit facility code + 16-bit card number
#   - Less common, check manufacturer specs
#   - Use: WIEGAND_BITS_READER_X=34
#
# HOW TO DETERMINE:
#   1. Try 26-bit first (most common)
#   2. Test card scan
#   3. If no read, try 34-bit
#   4. Check logs for "Wiegand parity failed"
#   5. Or configure via web interface (easier!)
#
# =======================================
# STORAGE CALCULATION
# =======================================
#
# Transaction size: ~100 bytes average
# Transactions per day: Estimate based on usage
#
# EXAMPLES:
#   Small office (50 users, 2 scans/user/day):
#     100 tx/day × 100 bytes = 10 KB/day
#     365 days = 3.65 MB/year
#     16 GB = ~4,400 years of storage!
#
#   Large office (200 users, 4 scans/user/day):
#     800 tx/day × 100 bytes = 80 KB/day
#     365 days = 29 MB/year
#     16 GB = ~550 years of storage
#
# Recommendation: 16GB is plenty for most deployments
#
# =======================================
# CONFIGURATION VIA WEB INTERFACE
# =======================================
#
# Many settings can be changed via web dashboard:
#
# Configuration Tab:
#   ✓ Wiegand bit format (26/34 per reader)
#   ✓ Tag re-detect delay (1-300 seconds)
#   ✓ Entry/Exit tracking (enable/disable + gap)
#   ✓ Entity ID (Firebase multi-site)
#   ✓ Wiegand timeout
#   ✓ Admin password (with current password)
#   ✓ API key (with current password)
#
# Changes via web interface override .env defaults
# Settings saved to: /home/pi/accessctl/config.json
#
# =======================================
# QUICK START
# =======================================
#
# 1. Copy this template:
#    cp env.template .env
#
# 2. Edit the .env file:
#    nano .env
#
# 3. At minimum, change these:
#    - ADMIN_PASSWORD_HASH (generate new hash)
#    - API_KEY (generate random key)
#    - SESSION_SECRET (generate random string)
#
# 4. Save and start the service:
#    python3 app.py
#    Or: sudo systemctl start access-control
#
# 5. Access web interface:
#    http://YOUR_PI_IP:5001/setup
#    Configure API key in browser
#
# 6. Login:
#    http://YOUR_PI_IP:5001/login
#    Username: admin
#    Password: (what you used to generate hash)
#
# =======================================
# HELPFUL COMMANDS
# =======================================
#
# Generate password hash:
#   python3 -c "import hashlib; password='MySecurePassword123'; print(hashlib.sha256(password.encode()).hexdigest())"
#
# Generate API key:
#   python3 -c "import secrets; print(secrets.token_hex(32))"
#
# Generate session secret:
#   python3 -c "import secrets; print(secrets.token_hex(32))"
#
# Check GPIO pins:
#   gpio readall
#
# Test pigpio daemon:
#   sudo systemctl status pigpiod
#
# View logs:
#   tail -f /home/pi/accessctl/access.log
#
# Check storage:
#   du -sh /home/pi/accessctl/transactions/
#
# =======================================
# TROUBLESHOOTING
# =======================================
#
# Cards not reading?
#   → Check WIEGAND_BITS matches your cards (26 or 34)
#   → Verify GPIO pin connections
#   → Check pigpio daemon: sudo systemctl status pigpiod
#
# Can't login to web interface?
#   → Verify ADMIN_PASSWORD_HASH is correct
#   → Check API_KEY matches browser localStorage
#   → Visit /setup page to configure API key
#
# Storage filling up?
#   → Increase MAX_TX_STORAGE_GB
#   → Check CLEANUP_FRACTION (0.5 = 50%)
#   → Manually delete old transaction files if needed
#
# Firebase not syncing?
#   → Check FIREBASE_CRED_FILE exists
#   → Verify internet connection
#   → Check logs for Firebase errors
#   → Firebase is optional - system works without it
#
# =======================================
# SUPPORT & DOCUMENTATION
# =======================================
#
# Complete documentation in project directory:
#   - QUICK_START.md (3-step guide)
#   - SETUP_GUIDE.md (Complete installation)
#   - README_FRONTEND.md (Web interface guide)
#   - CONFIGURATION_GUIDE.md (Wiegand setup)
#   - ADVANCED_CONFIG_FEATURES.md (All config options)
#   - ANALYTICS_GUIDE.md (Analytics features)
#   - OFFLINE_AND_PRIVACY.md (Offline & privacy)
#
# =======================================

# End of configuration file

